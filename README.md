# csnet23-malware-traffic-classification

CSNet 23

All trained models and the preprocessed dataset are publicly available at [heiBOX](https://heibox.uni-heidelberg.de/d/48aafe425162456e8751/).

# Getting started
The folder ML_code contains all the code we used to train our machine learning models on our custom datasets.
In following we describe how to use the different python scripts

```
> dataset_train_test_split.py
Will perform a stratified random split on a given dataset into train/test/validation set (70/15/15 split).
Usage: python dataset_train_test_split.py [DATASET_PATH]

DATASET_PATH:
  The folder containing the dataset ordered into subfolders of classes.

> train_model.py
Will train a model on a given dataset from scratch or continue training a given model.
Usage: python train_model.py [OPTIONS]

Options:
  -d, --dataset_type STRING   Can be "multiclass" or "binary"  [required]

  -m, --model_type STRING     Can be "fc" (VGG-FC), "notop" (VGG-NoTop), "resnet" (ResNet), or "next" (ResNeXt)  [required]

  -p, --preprocessing_type STRING  Can be "preprocessed": tells the script to
                              load the dataset from the PREPROCESSED_PATH
                              (given in dataset.py), or "payload": tells the
                              script to load the dataset from the PAYLOAD_PATH
                              (given in dataset.py). (PATHS need to be modified
                              in dataset.py!)  [required]

  -s --s saved_model [NONE|MODEL_PATH] Path to a model to continue training. If
                              NONE training is performed from scratch
                              [default: NONE]

  -t --training_optimizer [NONE|OPTIMIZER_PATH] Path to a optimizer to continue
                              training. If NONE a new optimier is initialized
                              [default: NONE]

  -l --learning_rate  [NONE|FLOAT] Defines the learning rate to be used. If
                              None the determined optimal hyperparameter for
                              the given model will be used  [default: NONE]

  -e --starting_epoch  [INTEGER] Defines the epoch to start training at
                              [default: 1]

  -n --num_epochs  [INTEGER]  The amount of epochs to train the model
                              [default: 35]
                              
  -o  [BOOLEAN]               If true oversampling is used.  [default: False]

  -a  [BOOLEAN]               If true an adaptive learning rate is used (If the
                              validation accuracy reaches 93% the lr will be
                              divided by 10.  [default: False]

> hyperparameter_optimization.py
Will perform hyperparameter_opimization (currently only for multiclass classification)
Usage: hyperparameter_optimization.py [OPTIONS]

Options:
  -m, --model_type STRING     Can be "fc" (VGG-FC), "notop" (VGG-NoTop), "resnet" (ResNet), or "next" (ResNeXt)  [required]

  -p, --preprocessing_type STRING  Can be "preprocessed": tells the script to
                              load the dataset from the PREPROCESSED_PATH
                              (given in dataset.py), or "payload": tells the
                              script to load the dataset from the PAYLOAD_PATH
                              (given in dataset.py). (PATHS need to be modified
                              in dataset.py!)  [required]

  -s --s save_dir_best_result [NONE|PATH] Path to save the best resulting model.
                              [default: NONE]

  -o  [BOOLEAN]               If true oversampling is used.  [default: False]
```
# Results: Accuracies and F1-Score
## Multiclass Classification

<table>
<thead>
  <tr>
    <th></th>
    <th>Accuracy</th>
    <th>F1-Score</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>All classes</td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/score/Accuracy_comparison_multiclass_preprocessed.svg" alt="acc_mult" width="500" height="500"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/score/F1_comparison_multiclass_preprocessed.svg" alt="f1_mult" width="500" height="500"><br></td>
  </tr>
  <tr>
    <td>Neris/Virut combined</td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/score/Accuracy_comparison_multiclass_preprocessed_accum.svg" alt="acc_mult_accum" width="500" height="500"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/score/F1_comparison_multiclass_preprocessed_accum.svg" alt="f1_mult_accum" width="500" height="500"></td>
  </tr>
</tbody>
</table>


## Binary Classification

<table>
<thead>
  <tr>
    <th></th>
    <th>Accuracy</th>
    <th>F1-Score</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>All classes</td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/binary/score/Accuracy_comparison_binary_preprocessed.svg" alt="acc_binary" width="500" height="500"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/binary/score/F1_comparison_binary_preprocessed.svg" alt="f1_binary" width="500" height="500"><br></td>
  </tr>
</tbody>
</table>

# Results: Training/Validation Loss
## Multiclass Classification

<table>
<thead>
  <tr>
    <th></th>
    <th>VGG-NoTop</th>
    <th>VGG-FullyConnected</th>
    <th>ResNet</th>
    <th>ResNeXt</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>All classes</td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_vgg-notop_mul_pre.svg" alt="loss_notop_mul" width="375" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_vgg-fc_mul_pre.svg" alt="loss_fc_mul" width="300" height="300"><br></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_resnet_mul_pre.svg" alt="loss_resnet_mul" width="180" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_resneXt_mul_pre.svg" alt="loss_resneXt_mul" width="180" height="300"></td>
  </tr>
  <tr>
    <td>Neris/Virut combined</td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_vgg-notop_mul_pre_accum.svg" alt="loss_notop_mul-accum" width="300" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_vgg-fc_mul_pre_accum.svg" alt="loss_fc_mul-accum" width="300" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_resnet_mul_pre_accum.svg" alt="loss_resnet_mul-accum" width="375" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/multiclass/loss/val_train_loss_resneXt_mul_pre_accum.svg" alt="loss_resneXt_mul-accum" width="375" height="300"></td>
  </tr>
</tbody>
</table>

## Binary Classification

<table>
<thead>
  <tr>
    <th></th>
    <th>VGG-NoTop</th>
    <th>VGG-FullyConnected</th>
    <th>ResNet</th>
    <th>ResNeXt</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>All classes</td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/binary/loss/val_train_loss_vgg-notop_binary_pre.svg" alt="loss_notop_bin" width="300" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/binary/loss/val_train_loss_vgg-fc_binary_pre.svg" alt="loss_fc_bin" width="265" height="300"><br></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/binary/loss/val_train_loss_resnet_binary_pre.svg" alt="loss_resnet_bin" width="300" height="300"></td>
    <td><img src="https://github.com/EMCL-Research-ITSecLab/csnet23-malware-traffic-classification/blob/main/score_loss_curves/binary/loss/val_train_loss_resneXt_binary_pre.svg" alt="loss_resneXt_bin" width="300" height="300"></td>
  </tr>
</tbody>
</table>











